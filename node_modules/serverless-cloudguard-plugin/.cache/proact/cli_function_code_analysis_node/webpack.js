const nodeExternals = require('webpack-node-externals');
const webpack = require('webpack');
const UglifyJsPlugin = require('uglifyjs-webpack-plugin');

webpack({
    entry: './index.js',
    target: 'node',
    mode: 'production',
    node: {
        __dirname: false,
        "aws-sdk": false
    },
    externals: [
        /aws-sdk/,
        nodeExternals()
    ],
    output: {
        libraryTarget: 'commonjs',
        path: __dirname + '/',
        filename: 'obfuscatedIndex.js'
    },
    plugins: [
        new UglifyJsPlugin({
            uglifyOptions: {
                mangle: {
                    reserved: ["exports", "module", "global", "handler"]
                }
            }
        }),
    ]
}, function (err, stat) {
    const error_array = stat["compilation"]["errors"];
    if (error_array.length > 0) {
        console.log("error webpacking", error_array);
        return;
    }
    console.log("packaging done!!");
});